{% extends '__main.html' %} 

{% block seo_meta %}
<meta name="title" content="{{ page_data.title }}" />
<meta name="robots" content="index, follow" />

<meta property="og:title" content="{{ page_data.title }}" />
<meta property="og:url" content="{{ shop_info.url }}/product?id={{ page_data.product_id }}" />
<meta property="og:type" content="webite" />
<meta property="og:description" content="{{ page_data.product_data.description }}" />
<meta property="og:image" content="https://bincommerzstaticstorage.blob.core.windows.net{{ page_data.default_gallery_image.thumbnailImage }}" />
{% endblock %}

{% block content %}
<div id="product-details-container" class="main" style="margin-bottom: 40px">
	<div class="shop_top">
		<div class="container" style="margin-top: 5%">
			{% if page_data.product_data != None %}
			<div class="row" id="product_details">
				<div class="col-md-7 col-sm-12">
					<div class="xzoom-container">
						<img
							class="xzoom"
							id="xzoom-default"
							src="https://bincommerzstaticstorage.blob.core.windows.net{{ page_data.default_gallery_image.thumbnailImage }}"
                            xpreview="{{ page_data.default_gallery_image.originalImage }}"
						/>
						<div class="xzoom-thumbs" style="margin-top: 20px;">
							{% for img_item in page_data.product_data.images %}

							<a
								href="https://bincommerzstaticstorage.blob.core.windows.net{{ img_item.originalImage }}"
								><img
                                    name="gallery_img"
									class="xzoom-gallery"
									width="80"
									src="https://bincommerzstaticstorage.blob.core.windows.net{{ img_item.thumbnailImage }}"
									xpreview="https://bincommerzstaticstorage.blob.core.windows.net{{ img_item.originalImage }}"
							/></a>

							{% endfor %}
						</div>
					</div>
				</div>
				<div
					class="col-md-5 col-sm-12"
					style="margin-top: 5%"
				>
					<div class="w-100">
						<h3 style="width: 100%">{{ page_data.product_data.name }}</h3>

						{% if page_data.product_data.discount == 0.00 %}
                        <p class="price-tag">Tk. {{ page_data.product_data.price }}</p>
                        {% endif %}

                        {% if page_data.product_data.discount > 0.00 %}
                        <p class="price-tag">Tk. 
                            <span style="color: rgb(39, 39, 39); text-decoration: line-through;">{{ page_data.product_data.price }}</span>
                            <span>{{ page_data.product_data.price - (page_data.product_data.price * (page_data.product_data.discount / 100)) }}</span>
                            <span>({{ page_data.product_data.discount }}% OFF)</span>
                        </p>
                        {% endif %}

                        {% if page_data.product_data.inStock == True %}
						<p class="in-stock">
							In Stock
						</p>
                        {% endif %}

                        {% if page_data.product_data.inStock == False %}
						<p style="color: red;">
							Out Of Stock
						</p>
                        {% endif %}

						<ul class="list-group list-group-flush">
							<li class="list-group-item" style="padding-left: 0; cursor: pointer; ">
                                <a 
                                id="prod_desc_trigger"
                                href="#product_description"
								class="
									d-flex
									justify-content-between
									align-items-center
								"
								style="text-decoration: none;">

                                SEE PRODUCT DESCRIPTION >>
                                </a>
							</li>
						</ul>

                        {% if page_data.product_data.inStock == True %}
						<div style="margin-top: 5%">
							<label for="validationTooltip01">QUANTITY: </label>
							<input
								type="number"
								class="form-control"
								value="1"
								min="1"
                                max="{{ page_data.product_data.stockQuantity }}"
								name="product_quantity"
							/>
						</div>

						<button
							class="exclusive btn-ex-red w-100"
							style="margin-top: 8%"
							onclick="addToCart(
                            '{{ page_data.product_id }}', 
                            '{{ page_data.product_data.name }}', 
                            '{{ page_data.product_data.imageUrl }}', 
                            '{{ page_data.product_data.price - (page_data.product_data.price * (page_data.product_data.discount / 100)) }}',
                            getQuantity());"
						>
							<span>ADD TO CART</span>
						</button>
                        {% endif %}
					</div>
				</div>
			</div>
            <div id="product_description" class="row" style="margin-top: 80px;">
                <div class="col-12">
                    <h4>Description</h4>
                </div>
                <div id="product_desc_quill" class="col-12" style="margin-top: 20px;"></div>
                <script>
                    var desc_html = document.getElementById("product_desc_quill");

                    if (desc_html) {
                        desc_html.innerHTML = '{{ page_data.product_data.description }}';
                    }
                </script>
                <style>
                    #product_desc_quill > p > img {
                        width: 100%;
                    }
                </style>
            </div>
			{% endif %} {% if page_data.product_data == None %}
			<div class="row">
				<div class="col-md-7 d-flex justify-content-center">
					<h1>Something went wrong</h1>
				</div>
			</div>
			{% endif %}
		</div>
	</div>
</div>

{% endblock %} {% block additional_scripts %}

<script src="/assets/js/xzoom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js" 
    integrity="sha512-UXumZrZNiOwnTcZSHLOfcTs0aos2MzBWHXOHOuB0J/R44QB0dwY5JgfbvljXcklVf65Gc4El6RjZ+lnwd2az2g==" 
    crossorigin="anonymous" referrerpolicy="no-referrer">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/js/foundation.min.js"></script>

<script>
	$(document).ready(function () {
        $('.xzoom, .xzoom-gallery').xzoom({
            zoomWidth: 400,
            title: true,
            tint: '#333',
            Xoffset: 15,
        });
        $('.xzoom2, .xzoom-gallery2').xzoom({
            position: '#xzoom2-id',
            tint: '#ffa200',
        });
        $('.xzoom3, .xzoom-gallery3').xzoom({
            position: 'lens',
            lensShape: 'circle',
            sourceClass: 'xzoom-hidden',
        });
        $('.xzoom4, .xzoom-gallery4').xzoom({
            tint: '#006699',
            Xoffset: 15,
        });
        $('.xzoom5, .xzoom-gallery5').xzoom({
            tint: '#006699',
            Xoffset: 15,
        });

        //Integration with hammer.js
        var isTouchSupported = 'ontouchstart' in window;

        if (isTouchSupported) {
            //If touch device
            // $('.xzoom, .xzoom2, .xzoom3, .xzoom4, .xzoom5').each(
            //     function () {
            //         var xzoom = $(this).data('xzoom');
            //         xzoom.eventunbind();
            //     }
            // );

            // $('.xzoom, .xzoom2, .xzoom3').each(function () {
            //     var xzoom = $(this).data('xzoom');
            //     $(this)
            //         .hammer()
            //         .on('tap', function (event) {
            //             event.pageX = event.gesture.center.pageX;
            //             event.pageY = event.gesture.center.pageY;
            //             var s = 1,
            //                 ls;

            //             xzoom.eventmove = function (element) {
            //                 element.hammer().on('drag', function (event) {
            //                     event.pageX = event.gesture.center.pageX;
            //                     event.pageY = event.gesture.center.pageY;
            //                     xzoom.movezoom(event);
            //                     event.gesture.preventDefault();
            //                 });
            //             };

            //             xzoom.eventleave = function (element) {
            //                 element.hammer().on('tap', function (event) {
            //                     xzoom.closezoom();
            //                 });
            //             };
            //             xzoom.openzoom(event);
            //         });
            // });

            // $('.xzoom4').each(function () {
            //     var xzoom = $(this).data('xzoom');
            //     $(this)
            //         .hammer()
            //         .on('tap', function (event) {
            //             event.pageX = event.gesture.center.pageX;
            //             event.pageY = event.gesture.center.pageY;
            //             var s = 1,
            //                 ls;

            //             xzoom.eventmove = function (element) {
            //                 element.hammer().on('drag', function (event) {
            //                     event.pageX = event.gesture.center.pageX;
            //                     event.pageY = event.gesture.center.pageY;
            //                     xzoom.movezoom(event);
            //                     event.gesture.preventDefault();
            //                 });
            //             };

            //             var counter = 0;
            //             xzoom.eventclick = function (element) {
            //                 element.hammer().on('tap', function () {
            //                     counter++;
            //                     if (counter == 1)
            //                         setTimeout(openfancy, 300);
            //                     event.gesture.preventDefault();
            //                 });
            //             };

            //             function openfancy() {
            //                 if (counter == 2) {
            //                     xzoom.closezoom();
            //                     $.fancybox.open(xzoom.gallery().cgallery);
            //                 } else {
            //                     xzoom.closezoom();
            //                 }
            //                 counter = 0;
            //             }
            //             xzoom.openzoom(event);
            //         });
            // });

            // $('.xzoom5').each(function () {
            //     var xzoom = $(this).data('xzoom');
            //     $(this)
            //         .hammer()
            //         .on('tap', function (event) {
            //             event.pageX = event.gesture.center.pageX;
            //             event.pageY = event.gesture.center.pageY;
            //             var s = 1,
            //                 ls;

            //             xzoom.eventmove = function (element) {
            //                 element.hammer().on('drag', function (event) {
            //                     event.pageX = event.gesture.center.pageX;
            //                     event.pageY = event.gesture.center.pageY;
            //                     xzoom.movezoom(event);
            //                     event.gesture.preventDefault();
            //                 });
            //             };

            //             var counter = 0;
            //             xzoom.eventclick = function (element) {
            //                 element.hammer().on('tap', function () {
            //                     counter++;
            //                     if (counter == 1)
            //                         setTimeout(openmagnific, 300);
            //                     event.gesture.preventDefault();
            //                 });
            //             };

            //             function openmagnific() {
            //                 if (counter == 2) {
            //                     xzoom.closezoom();
            //                     var gallery = xzoom.gallery().cgallery;
            //                     var i,
            //                         images = new Array();
            //                     for (i in gallery) {
            //                         images[i] = { src: gallery[i] };
            //                     }
            //                     $.magnificPopup.open({
            //                         items: images,
            //                         type: 'image',
            //                         gallery: { enabled: true },
            //                     });
            //                 } else {
            //                     xzoom.closezoom();
            //                 }
            //                 counter = 0;
            //             }
            //             xzoom.openzoom(event);
            //         });
            // });
        } else {
            //If not touch device

            //Integration with fancybox plugin
            $('#xzoom-fancy').bind('click', function (event) {
                var xzoom = $(this).data('xzoom');
                xzoom.closezoom();
                $.fancybox.open(xzoom.gallery().cgallery, {
                    padding: 0,
                    helpers: { overlay: { locked: false } },
                });
                event.preventDefault();
            });

            //Integration with magnific popup plugin
            $('#xzoom-magnific').bind('click', function (event) {
                var xzoom = $(this).data('xzoom');
                xzoom.closezoom();
                var gallery = xzoom.gallery().cgallery;
                var i,
                    images = new Array();
                for (i in gallery) {
                    images[i] = { src: gallery[i] };
                }
                $.magnificPopup.open({
                    items: images,
                    type: 'image',
                    gallery: { enabled: true },
                });
                event.preventDefault();
            });
        }

        $("#prod_desc_trigger").on('click', function(event) {
        // Make sure this.hash has a value before overriding default behavior
        console.log(this.hash);

        if (this.hash !== "") {
            // Store hash
            var hash = this.hash;

            // Prevent default anchor click behavior
            event.preventDefault();
            
            window.location.hash = hash;

            // Using jQuery's animate() method to add smooth page scroll
            // The optional number (800) specifies the number of milliseconds it takes to scroll to the specified area
            $('html, body').animate({
                scrollTop: $(hash).offset().top
            }, 50, function(){
                // Add hash (#) to URL when done scrolling (default click behavior)
                window.location.hash = hash;
            });
        } // End if
        });

        document.getElementsByName("gallery_img")[0].click();
    });

    function getQuantity() {
        var qunatity = document.getElementsByName('product_quantity')[0].value;

        if (qunatity < 1) {
            qunatity = 1;
        }

        return qunatity;
    }
</script>

{% endblock %}
